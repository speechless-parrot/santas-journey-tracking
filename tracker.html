<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santa's Journey Tracking üó∫Ô∏è</title>
    <meta name="description" content="Follow Santa on his magical journey around the world üåçüéÑ! Live updates, festive cheer, and holiday fun for the whole family.">

    <!-- Theme Color -->
    <meta name="theme-color" content="#d42426">
  
    <!-- Open Graph (Facebook, Discord, etc.) -->
    <meta property="og:title" content="üéÖ Santa's Journey Tracking üéÑ">
    <meta property="og:description" content="Experience the magic of Christmas all December long ‚ú®">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://speechless-parrot.github.io/santas-journey-tracking">
    <meta property="og:image" content="assets/santa-chimney-waving.png">
  
    <!-- Twitter Card (X, lol) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="üéÖ Santa's Journey Tracking üéÑ">
    <meta name="twitter:description" content="Follow Santa‚Äôs sleigh in real-time üéÑ‚ú®. Don‚Äôt miss the magic!">
    <meta name="twitter:image" content="assets/santa-chimney-waving.png">
    <link rel="icon" type="image/png" href="assets/santa-chimney-waving.png">

        <!-- ‚≠ê PRIMARY SEO META TAGS ‚≠ê -->
        <meta name="keywords" content="Santa tracker, Christmas tracker, Santa's journey, real-time Santa tracking, Christmas activities, holiday fun, Santa games, Christmas stories, festive tracker, where is Santa, Christmas games online, holiday activities for kids, Christmas entertainment, live Santa updates, Christmas countdown, Rudolph tracker, North Pole tracker, Santa tracker 2025, Christmas tracker 2025, Santa's journey 2025, live Santa updates 2025, Christmas countdown 2025, North Pole tracker 2025, holiday fun 2025, festive tracker 2025, Santa location 2025, track Santa live 2025, Santa Claus 2025, Christmas Eve tracker 2025, Santa map 2025, Christmas magic 2025">
        <meta name="author" content="">
        <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
        <meta name="language" content="English">
        
        <!-- üåç STRUCTURED DATA - RICH SNIPPETS FOR GOOGLE ‚≠ê -->
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "name": "Santa Tracker & Christmas Games",
            "url": "https://speechless-parrot.github.io",
            "potentialAction": {
                "@type": "SearchAction",
                "target": {
                    "@type": "EntryPoint",
                    "urlTemplate": "https://speechless-parrot.github.io/santas-journey-tracking"
                },
                "query-input": "required name=search_term_string"
            }
        }
        </script>
    
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "CreativeWork",
            "name": "Santa's Journey Tracker",
            "description": "Follow Santa on his real-time magical journey around the world with live updates, festive games, and holiday entertainment for the whole family.",
            "url": "https://speechless-parrot.github.io/santas-journey-tracking",
            "inLanguage": "en",
            "isAccessibleForFree": true,
            "image": {
                "@type": "ImageObject",
                "url": "assets/santa-chimney-waving.png",
                "width": 512,
                "height": 512
            }
        }
        </script>
    
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "BreadcrumbList",
                "itemListElement": [
                    {
                        "@type": "ListItem",
                        "position": 1,
                        "name": "Santa's Village",
                        "item": "https://speechless-parrot.github.io/santas-journey-tracking"
                    },
                    {
                        "@type": "ListItem",
                        "position": 2,
                        "name": "Santa Tracker",
                        "item": "https://speechless-parrot.github.io/santas-journey-tracking/tracker"
                    }
                ]
            }
            </script>
    
        <!-- üì± ADDITIONAL SEO OPTIMIZATION -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="Santa Tracker">
        <link rel="canonical" href="https://speechless-parrot.github. io/santas-journey-tracking">
        <link rel="alternate" hreflang="en" href="https://speechless-parrot.github.io/santas-journey-tracking">
        
        <!-- üîó PRECONNECT FOR PERFORMANCE (Helps Google see your site loads fast!) -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="dns-prefetch" href="https://unpkg.com">
        <link rel="dns-prefetch" href="https://api.npoint.io">


    <link href="https://fonts.googleapis.com/css?family=Google+Sans:100,300,400,500,700,900,100i,300i,400i,500i,700i,900i" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Add these in the head section -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script src="https://unpkg.com/leaflet.antimeridian@1.0.0/dist/leaflet.antimeridian-src.js"></script>
    <style>
:root {
    --christmas-red: #d42426;
    --christmas-green: #165b33;
    --snow-white: #ffffff;
    --gold: #ffd700;
    --stats-height: 120px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Google Sans', sans-serif;
}

body {
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

#map {
    flex: 1 1 auto;
    min-height: 200px;
    width: 100%;
    z-index: 1;
}

.leaflet-container {
    background: #0B1025 !important; /* Deep dark blue instead of grey */
}

.santa-glow-icon {
    filter: drop-shadow(0 0 12px rgba(255, 0, 0, 0.9))
            drop-shadow(0 0 20px rgba(255, 0, 0, 0.6))
            drop-shadow(0 0 28px rgba(255, 0, 0, 0.4));
}

.destination-marker {
    filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.9))
            drop-shadow(0 0 12px rgba(255, 255, 255, 0.5));
}

.top-bar {
    background: linear-gradient(135deg, var(--christmas-red), var(--christmas-green));
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    z-index: 1000;
}

.title {
    font-size: 1.5rem;
    font-weight: 500;
}

.controls {
    display: flex;
    gap: 0.5rem;
}

.control-button {
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    padding: 0.5rem;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.control-button:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
}

/* ===== STATS BAR - REDESIGNED ===== */
.stats-bar {
    background: linear-gradient(135deg, var(--christmas-red), var(--christmas-green));
    padding: 1rem;
    color: white;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 0.8rem;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.2);
    flex-shrink: 0;
    width: 100%;
    height: auto; /* override any inherited shrink */
}

.stat-box {
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 1rem;
    border-radius:  16px;
    display:  flex;
    flex-direction:  column;
    align-items:  flex-start;
    gap:  0.5rem;
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.15);
}

.stat-box:hover {
    background:  rgba(255,255,255,0.18);
    transform: translateY(-2px);
    border-color: rgba(255,255,255,0.25);
}

.stat-icon {
    font-size: 20px;
    color: var(--gold);
    flex-shrink: 0;
}

.stat-label {
    font-size: 0.7rem;
    opacity: 0.8;
    font-weight: 400;
    text-transform:  uppercase;
    letter-spacing:  0.5px;
}

.stat-value {
    font-size: 1rem;
    font-weight: 500;
    line-height:  1.3;
    word-break: break-word;
    flex-wrap: wrap;
}

/* NEW:  Timing info inside the box */
.stat-timing {
    font-size: 0.85rem;
    opacity: 0.9;
    font-weight: 400;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    margin-top:  0.2rem;
}

.stat-timing-icon {
    font-size:  16px;
    flex-shrink: 0;
}

.stat-timing-value {
    word-break: break-word;
}

/* üéÖ CLEAN & SNATCHED MOBILE UI üéÖ */


@media (max-width: 600px) {
    /* 2. Title Swap Magic: Changing text ONLY on mobile ü™Ñ */
    .title {
        font-size: 1.1rem !important;
        visibility: hidden;
        position: relative;
        white-space: nowrap;
    }

    .title::after {
        content: "üéÖ Santa Tracking üó∫Ô∏è"; /* Short & Sweet version! */
        visibility: visible;
        position: absolute;
        left: 0; /* Keeping it left-aligned, no centering here! üíÖ */
    }

    .santa-update-bar {
        padding: 0.5rem 1rem !important; /* Compact & clean */
        font-size: 0.85rem !important;
    }
}

/* Responsive Breakpoints */
@media (max-width: 768px) {
    #map {
    max-height: calc(100vh - var(--stats-height) - 64px);
    }

    .stats-bar {
        padding: 0.8rem;
        gap: 0.6rem;
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 2 per row */
        grid-auto-rows: 1fr;                   /* make all rows equal height */
    }

    .stat-box {
        display: flex;
        flex-direction: column;
        align-items: stretch;  /* fill row height properly */
        padding: 0.8rem;
    }

    .stat-box:nth-child(3) {
        grid-column: 1 / -1;  /* NEW:  Make 3rd box span full width */
    }
    .stat-value {
        font-size: 0.95rem;
    }
    
    .stat-timing {
        font-size: 0.8rem;
    }
}

@media (max-width:  480px) {
    #map {
    max-height: calc(100vh - var(--stats-height) - 64px);
    }

    .stats-bar {
        padding: 0.6rem;
        gap: 0.5rem;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-auto-rows: 1fr;
    }

    .stat-box {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        padding: 0.6rem;
        gap: 0.4rem;
    }

    .stat-box:nth-child(3) {
        grid-column: 1 / -1;  /* NEW:  Make 3rd box span full width */
    }
    
    
    .stat-icon {
        font-size: 18px;
    }
    
    .stat-value {
        font-size: 0.9rem;
    }
    
    .stat-label {
        font-size: 0.65rem;
    }
    
    .stat-timing {
        font-size: 0.75rem;
    }
    
    .stat-timing-icon {
        font-size: 14px;
    }
}

/* Leaflet Customization */
.leaflet-control-zoom {
    border: none !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
}

.leaflet-control-zoom a {
    background: white !important;
    color: var(--text) !important;
    border: none !important;
    width: 40px !important;
    height: 40px !important;
    line-height: 40px !important;
    font-size: 18px !important;
}

.leaflet-control-zoom a:first-child {
    border-radius: 12px 12px 0 0 !important;
}

.leaflet-control-zoom a:last-child {
    border-radius: 0 0 12px 12px !important;
}

/* Add this to your existing style tag */
.custom-popup {
    background: white;
    border-radius: 20px;
    padding: 1.5rem;
    max-width: 400px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
}

.custom-popup .leaflet-popup-content-wrapper {
    background: transparent;
    box-shadow: none;
    padding: 0;
    margin: 0;
}

.custom-popup .leaflet-popup-tip-container {
    display: none;
}

.photo-carousel {
    position: relative;
    margin: -1.5rem -1.5rem 1rem -1.5rem;
    border-radius: 20px 20px 0 0;
    overflow: hidden;
    height: 200px;
}

.carousel-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    display: none;
}

.carousel-image.active {
    display: block;
}

.carousel-nav {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 6px;
    z-index: 2;
}

.carousel-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
    cursor: pointer;
    transition: all 0.3s ease;
}

.carousel-dot.active {
    background: white;
    transform: scale(1.2);
}

.carousel-attribution {
    position: absolute;
    bottom: 0;
    right: 0;
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 4px 8px;
    font-size: 0.8rem;
    border-radius: 8px 0 0 0;
}

.carousel-controls {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    display: flex;
    justify-content: space-between;
    padding: 0 10px;
}

.carousel-button {
    background: rgba(255,255,255,0.8);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.carousel-button:hover {
    background: white;
    transform: scale(1.1);
}

.popup-content {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.location-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.city-title {
    font-size: 1.4rem;
    font-weight: 500;
    color: var(--christmas-red);
}

.region-text {
    color: #666;
    font-size: 1rem;
}

.time-info, .presents-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.8rem;
    background: #f5f5f5;
    border-radius: 12px;
}

.info-icon {
    color: var(--christmas-green);
}

.info-text {
    flex: 1;
    font-size: 0.9rem;
    line-height: 1.4;
}

.info-label {
    color: #666;
    font-size: 0.8rem;
}

.info-value {
    color: #333;
    font-weight: 500;
}

/* ‚Äî‚Äî‚Äî WIKIPEDIA SUMMARY SECTION ‚Äî‚Äî‚Äî */
.wiki-section {
    background: #f7f7f7;
    border-radius: 12px;
    padding: 1rem;
    margin-top: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
}

.wiki-header {
    font-weight: 600;
    font-size: 1rem;
    color: var(--christmas-green);
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.wiki-icon {
    font-size: 1.2rem;
    color: var(--christmas-green);
}

.wiki-extract {
    font-size: 0.85rem;
    line-height: 1.45;
    color: #444;
    max-height: 150px;
    overflow-y: auto;
}

.wiki-readmore {
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--christmas-red);
    text-decoration: none;
}

.wiki-readmore:hover {
    text-decoration: underline;
}


.custom-tooltip {
    background: linear-gradient(135deg, var(--christmas-red), var(--christmas-green));
    border: none;
    border-radius: 12px;
    padding: 0.5rem 1rem;
    font-family: 'Google Sans', sans-serif;
    font-size: 1rem;
    color: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* Custom cluster styles */
.marker-cluster {
    background: linear-gradient(135deg, var(--christmas-red), var(--christmas-green));
    border-radius: 50%;
}

.marker-cluster div {
    background-color: rgba(255, 255, 255, 0.9);
    color: var(--christmas-red);
    font-weight: 500;
    font-family: 'Google Sans', sans-serif;
}

@media (max-width: 768px) {
    .title {
        font-size: 1.2rem;
    }
}

/* üåç Location Privacy Modal */
.location-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7); /* Darken background */
    backdrop-filter: blur(5px); /* Blur effect */
    z-index: 10000; /* On top of EVERYTHING */
    display: none; /* Hidden by default */
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease-out;
}

.location-modal {
    background: white;
    padding: 2rem;
    border-radius: 24px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    position: relative;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    animation: slideUp 0.3s ease-out;
}

.modal-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #666;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.2s;
    line-height: 1;
}

.modal-close-btn:hover {
    background: #f0f0f0;
    color: var(--christmas-red);
}

.modal-icon {
    font-size: 48px;
    color: var(--christmas-red);
    margin-bottom: 1rem;
}

.modal-title {
    font-size: 1.5rem;
    color: var(--christmas-red);
    margin-bottom: 1rem;
    font-weight: 700;
}

.modal-text {
    color: #444;
    line-height: 1.6;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
}

.modal-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
}

.btn-modal {
    padding: 10px 24px;
    border-radius: 50px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s;
    font-size: 1rem;
}

.btn-modal:active {
    transform: scale(0.95);
}

.btn-allow {
    background: var(--christmas-green);
    color: white;
    box-shadow: 0 4px 12px rgba(22, 91, 51, 0.3);
}

.btn-deny {
    background: #f0f0f0;
    color: #666;
}

.btn-allow:hover { background: #1a6b3c; }
.btn-deny:hover { background: #e0e0e0; }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }


.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, var(--christmas-red), var(--christmas-green));
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease-out;
}

.loading-content {
    text-align: center;
    color: white;
}

.loading-title {
    font-size: 2rem;
    margin-bottom: 2rem;
    font-weight: 500;
}

.loading-spinner {
    width: 120px;
    height: 120px;
    margin-bottom: 2rem;
    animation: spin 2s linear infinite;
}

.loading-message {
    font-size: 1.2rem;
    opacity: 0.9;
}

.loading-messages {
    margin-top: 1rem;
    font-size: 1rem;
    opacity: 0.8;
}

.fade-out {
    opacity: 0;
    pointer-events: none;
}

.santa-update-bar {
    background: linear-gradient(135deg, rgba(212, 36, 38, 0.95), rgba(22, 91, 51, 0.95));
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 0.8rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    animation: slideDown 0.5s ease-out;
    position: relative;
    z-index: 900;
}

.update-content {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex: 1;
}

.update-icon {
    color: var(--gold);
    font-size: 24px;
    animation: bounce 2s infinite;
}

.update-text {
    flex: 1;
}

.update-message {
    color: white;
    font-size: 0.95rem;
    margin-bottom: 0.2rem;
    line-height: 1.4;
}

.update-message .didyouknow {
    font-weight: 500;
    color: var(--gold);
    margin-right: 0.5rem;
}


.next-update {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.8rem;
}

.update-countdown {
    color: var(--gold);
    font-weight: 500;
}

@keyframes slideDown {
    from {
        transform: translateY(-100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-3px);
    }
}

/* Make it responsive */
@media (max-width: 600px) {
    .santa-update-bar {
        padding: 0.6rem;
    }
    
    .update-icon {
        font-size: 20px;
    }
    
    .update-message {
        font-size: 0.85rem;
    }
    
    .next-update {
        font-size: 0.75rem;
    }
}

/* üç™ Cookie Toggle Animation */
.stat-box.clickable {
    cursor: pointer;
}

.stat-box.clickable:active {
    transform: scale(0.95);
}

.stat-icon.flip-animation {
    animation: flipIcon 0.6s ease-in-out;
}

@keyframes flipIcon {
    0% {
        transform: rotateY(0deg) scale(1);
    }
    50% {
        transform: rotateY(90deg) scale(1.1);
    }
    100% {
        transform: rotateY(0deg) scale(1);
    }
}

.stat-value.flip-animation {
    animation: slideSwitch 0.6s ease-in-out;
}

@keyframes slideSwitch {
    0% {
        opacity: 1;
        transform: translateX(0);
    }
    50% {
        opacity: 0;
        transform: translateX(10px);
    }
    100% {
        opacity: 1;
        transform: translateX(0);
    }
}

.stat-label.flip-animation {
    animation: labelFlip 0.6s ease-in-out;
}

@keyframes labelFlip {
    0% {
        opacity: 1;
    }
    50% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}

/* ===== DESKTOP SIDEBAR LAYOUT ===== */
@media (min-width: 1024px) {
    body {
        flex-direction: row-reverse;  /* Reverse to put sidebar on right */
    }

    .top-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 360px;  /* Offset by sidebar width */
        z-index: 1000;
        width: calc(100% - 360px);
    }

    .stats-bar,
    .santa-update-bar {
        display: none ! important;  /* Hide on desktop */
    }

    #map {
        margin-right: 360px; /* match your new sidebar width */
    margin-top: 64px;    /* top bar height */
    height: calc(100vh - 64px);
        flex:  1;
    }

    /* NEW SIDEBAR */
    .sidebar {
        position: fixed;
        right: 0;
        top:  0;
        bottom: 0;
        width:  360px;
        background:  linear-gradient(135deg, var(--christmas-red), var(--christmas-green));
        color: white;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        box-shadow: -2px 0 8px rgba(0,0,0,0.2);
        z-index: 800;
        padding: 2rem 1.5rem;
        gap: 1.5rem;
    }

    .sidebar-title {
        font-size: 1.3rem;
        font-weight:  500;
        margin-bottom: 0.5rem;
    }

    /* üéÑ LIVE Banner */
.sidebar-live-banner {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.15);
    padding: 10px 14px;
    border-radius: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    color: #ffdddd;
    box-shadow: 0 0 12px rgba(255, 0, 0, 0.2);
    backdrop-filter: blur(6px);
    border: 1px solid rgba(255,255,255,0.18);
}

.live-dot {
    width: 10px;
    height: 10px;
    background: #ff2d2d;
    border-radius: 50%;
    box-shadow: 0 0 8px #ff2d2d;
    animation: liveBlink 1s infinite ease-in-out;
}

@keyframes liveBlink {
    0% { opacity: 1; }
    50% { opacity: 0.2; }
    100% { opacity: 1; }
}

.live-text {
    font-size: 0.75rem;
    color: #fff;
}


    .sidebar-stat {
        background: rgba(255,255,255,0.12);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 1.2rem;
        border-radius:  16px;
        border: 1px solid rgba(255,255,255,0.15);
        transition: all 0.3s ease;
    }

    .sidebar-stat:hover {
        background: rgba(255,255,255,0.18);
        transform: translateX(2px);  /* Move right on hover */
        border-color: rgba(255,255,255,0.25);
    }

    .sidebar-stat-icon {
        font-size: 20px;
        color: var(--gold);
        margin-bottom: 0.5rem;
    }

    .sidebar-stat-label {
        font-size: 0.7rem;
        opacity: 0.8;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.3rem;
    }

    .sidebar-stat-value {
        font-size: 1.1rem;
        font-weight:  500;
        line-height: 1.3;
        word-break: break-word;
        margin-bottom: 0.5rem;
    }

    .sidebar-stat-timing {
        font-size: 0.8rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    .sidebar-stat-timing-icon {
        font-size: 14px;
        flex-shrink: 0;
    }

    /* Clickable stat for presents */
    .sidebar-stat.clickable {
        cursor: pointer;
    }

    .sidebar-stat.clickable:active {
        transform: scale(0.98);
    }

    /* Santa updates section */
.sidebar-updates {
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(10px);
    padding: 1rem;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.15);
}

.sidebar-updates-title {
    font-size: 0.9rem;
    text-transform: uppercase;
    opacity: 0.9;
    margin-bottom: 0.8rem;
}

.sidebar-update-current {
    display: flex;
    gap: 0.8rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.sidebar-update-icon {
    font-size: 20px;
    color: var(--gold);
}

.sidebar-update-message {
    font-size: 0.9rem;
    line-height: 1.3;
    color: white;
    margin-bottom: 0.2rem;
}

.sidebar-update-next {
    font-size: 0.75rem;
    opacity: 0.8;
}

.sidebar-update-countdown {
    color: var(--gold);
    font-weight: 500;
}

.sidebar-update-history {
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    padding-right: 4px;
}

.sidebar {
    scrollbar-width: none;      /* Firefox */
    -ms-overflow-style: none;   /* Internet Explorer / Edge */
}

.sidebar::-webkit-scrollbar {
    display: none;              /* Chrome / Safari */
}


.sidebar-update-card {
    background: rgba(255,255,255,0.12);
    border-radius: 14px;
    padding: 1rem;
    border: 1px solid rgba(255,255,255,0.15);
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
}

.sidebar-update-card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    opacity: 0.9;
}

.sidebar-update-card-icon {
    font-size: 18px;
    color: var(--gold);
}

.sidebar-update-card-title {
    font-size: 0.85rem;
    font-weight: 500;
    opacity: 0.95;
}

.sidebar-update-card-text {
    font-size: 0.9rem;
    line-height: 1.4;
}

.sidebar-update-card-time {
    font-size: 0.7rem;
    opacity: 0.65;
    margin-top: 0.4rem;
}

.sidebar-update-card-engagement {
    display: flex;
    gap: 1rem;
    opacity: 0.75;
}

.sidebar-update-card-engagement .material-symbols-rounded {
    font-size: 18px;
    cursor: pointer;
    transition: 0.2s;
}

.sidebar-update-card-engagement .material-symbols-rounded:hover {
    opacity: 1;
    transform: scale(1.15);
}

.sidebar-update-history .sidebar-update-card {
    margin-top: 1rem; /* matches .sidebar-update-current margin-bottom */
    padding-top: 1rem; /* matches padding-bottom vibe */
    border-top: 1px solid rgba(255,255,255,0.1); /* matches border-bottom */
}

/* --- PERFECTLY MATCHED Activity Card Styling --- */

/* 1. Container adjustments for spacing (no change needed here) */
.sidebar-activity-container {
    padding: 0 1.5rem 1rem 1.5rem; 
    margin-top: 1.5rem;
    box-sizing: border-box; 
}

/* THE CORE ACTIVITY CARD: NOW MATCHES .sidebar-stat and .sidebar-updates */
.activity-card {
    /* üî• Key change: Frosted Glass Look from sidebar-stat and sidebar-update-card */
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    
    padding: 0;
    border-radius: 16px; /* Matches other sidebar components */
    border: 1px solid rgba(255,255,255,0.15);
    
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden; /* Crucial for clipping the top border */
    text-decoration: none; 
    display: block;
    box-shadow: none; /* No external shadow, relies on border and background */
}

/* Festive top border - perfect as is, uses Z-index to sit on top */
.activity-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 8px;
    background: linear-gradient(90deg, 
        var(--christmas-red) 0%, 
        var(--christmas-green) 50%, 
        var(--christmas-red) 100%);
    z-index: 10;
}

.activity-card-content {
    /* Adds internal padding and space for the 8px top border */
    padding: 2.5rem 2rem 2rem;
    margin-top: 10px; /* Pushes content down past the 8px header + 2px space */
    background: transparent; /* Content background is transparent, uses card background */
}

/* Icon style - kept the festive look, still looks great! */
.activity-card .material-symbols-rounded {
    font-size: 52px;
    color: var(--christmas-red);
    background: var(--snow-white); /* White background for the icon circle */
    width: 75px;
    height: 75px;
    margin: 0 auto 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 20px;
    box-shadow: 
        0 1px 4px rgba(0,0,0,0.15),
        inset 0 1px 2px rgba(255,255,255,0.7);
    transition: all 0.3s ease;
}

.activity-card h3 {
    /* üî• Key change: Use white text color like the rest of the sidebar */
    color: var(--snow-white); 
    font-size: 1.4rem;
    margin-bottom: 0.75rem;
    font-weight: 600;
    line-height: 1.3;
}

.activity-card p {
    /* üî• Key change: Use white text with opacity like secondary text in sidebar stats */
    color: rgba(255, 255, 255, 0.85); 
    font-size: 0.95rem;
    line-height: 1.5;
}

/* Hover effect - Now perfectly matches .sidebar-stat:hover */
.activity-card:hover {
    background: rgba(255,255,255,0.18); /* Match sidebar-stat:hover background */
    transform: translateX(2px); /* Match sidebar-stat:hover movement */
    border-color: rgba(255,255,255,0.25); /* Match sidebar-stat:hover border color */
}

.activity-card:hover .material-symbols-rounded {
    /* Keeping the gorgeous icon hover effect */
    transform: scale(1.05) rotate(-3deg);
    background: linear-gradient(135deg, var(--christmas-red), #b81e1f);
    color: white;
    box-shadow: 0 0 0 0; 
}

}

/* HIDE SIDEBAR ON MOBILE/TABLET */
@media (max-width: 1023px) {
    .sidebar {
        display: none ! important;
    }
    
    body {
        flex-direction: column;  /* Reset to normal */
    }

    #map {
        margin-left: 0;
        margin-right: 0;
        margin-top: 0;
    }

    .top-bar {
        position: static;
        width: 100%;
    }
}
    </style>
</head>
<body>
    <audio id="bgMusic" loop>
        <source src="assets/music.mp3" type="audio/mp3">
    </audio>

    <div class="location-modal-overlay" id="locationModal">
        <div class="location-modal">
            <button class="modal-close-btn" id="closeLocationModal">‚úï</button>
            
            <span class="material-symbols-rounded modal-icon">explore</span>
            <h2 class="modal-title">Enable Santa's Compass? üß≠</h2>
            
            <p class="modal-text">
                We use your location only to help calculate Santa's estimated arrival time at your chimney! üè†üéÅ
                <br><br>
                <strong>This is completely optional.</strong> All calculations happen on your device, and your location is never sent to our North Pole servers. ‚ú®
                <br><br>
                Just a heads-up: if you say ‚ÄúNo thanks,‚Äù you won‚Äôt see Santa‚Äôs ETA ‚Äî you‚Äôll always see how far he‚Äôs traveled instead. üöÄ
        
            </p>
    
            <div class="modal-buttons">
                <button class="btn-modal btn-deny" id="denyLocation">No thanks</button>
                <button class="btn-modal btn-allow" id="allowLocation">Enable access</button>
            </div>
        </div>        
    </div>

    <div class="location-modal-overlay" id="imageModal">
        <div class="location-modal">
            <button class="modal-close-btn" id="closeImageModal">‚úï</button>
            
            <img id="modalImage" src="" style="width:100%;border-radius:16px;" />
        </div>
    </div>
    

    <div class="sidebar" id="sidebar">
        <div class="sidebar-live-banner">
            <span class="live-dot"></span>
            <span class="live-text">LIVE ‚Äî FROM THE TRACKING CENTER</span>
        </div>
        
        <div class="sidebar-stat">
            <div class="sidebar-stat-icon">
                <span class="material-symbols-rounded">location_on</span>
            </div>
            <div class="sidebar-stat-label" id="sidebarLocationLabel">Current Stop</div>
            <div class="sidebar-stat-value" id="sidebarLocation">Santa's Village, North Pole</div>
            <div class="sidebar-stat-timing">
                <span class="material-symbols-rounded sidebar-stat-timing-icon">flight_takeoff</span>
                <span id="sidebarTiming">00:00 until departure</span>
            </div>
        </div>
    
        <div class="sidebar-stat">
            <div class="sidebar-stat-icon">
                <span class="material-symbols-rounded" id="sidebarPresentsIcon">featured_seasonal_and_gifts</span>
            </div>
            <div class="sidebar-stat-label">Presents Delivered</div>
            <div class="sidebar-stat-value" id="sidebarPresentsValue">0</div>
        </div>
        
        <div class="sidebar-stat">
            <div class="sidebar-stat-icon">
                <span class="material-symbols-rounded">cookie</span>
            </div>
            <div class="sidebar-stat-label">Cookies Eaten</div>
            <div class="sidebar-stat-value" id="sidebarCookiesValue">0</div>
        </div>
    
        <div class="sidebar-stat">
            <div class="sidebar-stat-icon">
                <span class="material-symbols-rounded">route</span>
            </div>
            <div class="sidebar-stat-label" id="sidebarDistanceLabel">Distance Travelled</div>
            <div class="sidebar-stat-value" id="sidebarDistanceValue">0 km</div>
        </div>

            <!-- Santa updates Feed -->
    <div class="sidebar-updates">
        <h3 class="sidebar-updates-title">From the North Pole</h3>

        <div class="sidebar-update-history" id="sidebarUpdateHistory">

            <div class="sidebar-update-current sidebar-update-card" id="currentUpdateCard">
                <div class="sidebar-update-card-header">
                    <span class="material-symbols-rounded sidebar-update-card-icon">chat</span>
                    <span class="sidebar-update-card-title">Update from Santa</span>
                </div>

                <div class="sidebar-update-card-time" id="sidebarCurrentTimestamp">
                    --:--
                </div>
        
                <div class="sidebar-update-card-text" id="sidebarCurrentUpdateText">
                    Loading‚Ä¶
                </div>
        
                <div class="sidebar-update-card-engagement">
                    <span class="material-symbols-rounded">favorite</span>
                    <span class="material-symbols-rounded">chat_bubble</span>
                    <span class="material-symbols-rounded">repeat</span>
                    <span class="material-symbols-rounded">send</span>
                </div>
        
                <div class="sidebar-update-card-time">
                    Next update in <span class="sidebar-update-countdown">--:--</span>
                </div>
            </div>
        
            <!-- Older updates will be injected here by JS -->
        </div>        
    </div>

    <div class="sidebar-activity-container" id="randomActivityCardContainer"></div>


    </div>


   <div class="loading-screen">
    <div class="loading-content">
        <img src="assets/santa-chimney-waving.png" alt="Santa" class="loading-spinner">
        <h1 class="loading-title">Connecting to the North Pole ‚ùÑÔ∏è</h1>
        <p class="loading-message">Establishing secure connection to Santa's Workshop...</p>
        <div class="loading-messages"></div>
    </div>
</div>


    <div class="top-bar">
        <h1 class="title">üéÖ Santa's Journey Tracking üó∫Ô∏è</h1>
        <div class="controls">
            <button class="control-button" onclick="window.location.href='index.html'">
                <span class="material-symbols-rounded">home</span>
            </button>
            <button class="control-button" id="fullscreenButton">
                <span class="material-symbols-rounded">fullscreen</span>
            </button>
            <button class="control-button">
                <span class="material-symbols-rounded">lock</span>
            </button>
        </div>
    </div>

    <div id="map"></div>

    <div class="santa-update-bar">
        <div class="update-content">
            <span class="material-symbols-rounded update-icon">chat</span>
            <div class="update-text">
                <p class="update-message">Ho ho ho! Just delivered presents to all the good children in Tokyo! The reindeer loved the carrots! ü•ï</p>
                <p class="next-update">Next update in: <span class="update-countdown">05:00</span></p>
            </div>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-box">
            <span class="material-symbols-rounded stat-icon">location_on</span>
            <div class="stat-label">Current Stop</div>
            <div class="stat-value">Santa's Village, North Pole</div>
            <div class="stat-timing">
                <span class="material-symbols-rounded stat-timing-icon">flight_takeoff</span>
                <span class="stat-timing-value">00:00 until departure</span>
            </div>
        </div>
    
        <div class="stat-box clickable" id="presentsStatBox">
            <span class="material-symbols-rounded stat-icon">featured_seasonal_and_gifts</span>
            <div class="stat-label">Presents Delivered</div>
            <div class="stat-value">0</div>
        </div>
    
        <div class="stat-box">
            <span class="material-symbols-rounded stat-icon">route</span>
            <div class="stat-label">Distance Travelled</div>
            <div class="stat-value">0 km</div>
        </div>
    </div>

    <script>
        window.realPresentsDelivered = 0;
        let trackerPaused = false;

        // Initialize map variables
        let isFullscreen = false;
        let isLocked = true;
        let destinations = [];
        let santaPosition = [84.6, 168]; // North Pole default
        
        // Custom Santa icon - now bigger and more festive! üéÖ
const santaSleighIcon = L.icon({
    iconUrl: 'assets/santa-sleigh.png',
    iconSize: [72, 72],
    iconAnchor: [36, 36],
    popupAnchor: [0, -36],
    className: 'santa-glow-icon'
});

const santaChimneyIcon = L.icon({
    iconUrl: 'assets/santa-chimney-waving.png',
    iconSize: [72, 72],
    iconAnchor: [36, 36],
    popupAnchor: [0, -36],
    className: 'santa-glow-icon'
});
    
// Initialize the map centered on Santa with custom options
const map = L.map('map', {
    center: santaPosition,
    zoom: 10,
    dragging: ! isLocked,
    keyboard: ! isLocked,
    zoomControl: true,
    scrollWheelZoom: ! isLocked,
    touchZoom: !isLocked,
    doubleClickZoom: true,
    preferCanvas: true,
    renderer: L.canvas({
        padding: 0.5,
        tolerance: 10
    }),
});


// Add the tile layer with preloading
    const tileLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    // const tileLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors',
    updateWhenIdle: false,
    updateWhenZooming: false,
    keepBuffer:  20,  // Much higher for water areas
    maxZoom:  19,
    crossOrigin: true,
    fadeAnimation: false,  // Disable fade to avoid visual glitches
    updateWhenZooming: false
}).addTo(map);
    
        map.attributionControl.setPrefix('');
    
        // Add Santa marker
        const santaMarker = L.marker(santaPosition, {
            icon: santaSleighIcon,
            zIndexOffset: 999999, // put santa ABOVE THE GODS
            opacity: 0
        }).addTo(map);

        // üèîÔ∏è STEP 1: Define the North Pole Icon (keeping it crisp & huge!) ‚ùÑÔ∏è
        const northPoleIcon = L.icon({
    iconUrl: 'https://raw.githubusercontent.com/google/santa-tracker-web/refs/heads/main/static/img/tracker/northpole.png',
    iconSize: [132, 100], 
    // üìç CHANGE THIS: Center the anchor so the icon sits evenly 
    // [Width/2, Height/2]
    iconAnchor: [66, 50], 
    popupAnchor: [0, -50],
    className: 'north-pole-marker'
});

// üìç STEP 2: Fix it at the literal top of the world! [90, 0] üåç
L.marker([84.6, 168], { 
    icon: northPoleIcon,
    zIndexOffset: -1000, // üõ∑ Keeps it BEHIND Santa so he stays the main character!
    interactive: false   // üö´ It's just there for the vibes (non-clickable)
}).addTo(map);

// üéÄ Initialize the Magical Trail (Start it empty)
const santaPath = L.Wrapped.wrappedPolyline([], {
    color: '#d42426',
    weight: 4,
    opacity: 0.7,
    dashArray: '1, 12', // ‚ùÑÔ∏è Makes it look like a trail of snowflakes/sparkles
    className: 'santa-trail-glow'
}).addTo(map);

        
    
        // Helper function to update destination dates to current year
        function updateDestinationDates(destinations) {
            const currentYear = new Date().getUTCFullYear();
            return destinations.map(dest => {
                // Get the original date parts
                const arrivalDate = new Date(dest.arrival);
                const departureDate = new Date(dest.departure);
                
                // Create new dates with current year
                const newArrival = new Date(Date.UTC(
                    currentYear,
                    arrivalDate.getUTCMonth(),
                    arrivalDate.getUTCDate(),
                    arrivalDate.getUTCHours(),
                    arrivalDate.getUTCMinutes(),
                    arrivalDate.getUTCSeconds()
                ));
                
                const newDeparture = new Date(Date.UTC(
                    currentYear,
                    departureDate.getUTCMonth(),
                    departureDate.getUTCDate(),
                    departureDate.getUTCHours(),
                    departureDate.getUTCMinutes(),
                    departureDate.getUTCSeconds()
                ));
    
                return {
                    ...dest,
                    arrival: newArrival.getTime(),
                    departure: newDeparture.getTime(),
                    presentsDelivered: Math.ceil(dest.presentsDelivered * 1.5)
                };
            });
        }
    
        // Function to find Santa's current location
        function findSantaLocation() {
            const now = Date.now();
            
            // Create Date objects for comparison
            const currentYear = new Date().getUTCFullYear();
            const startTime = new Date(Date.UTC(currentYear, 11, 24, 10, 0, 0)).getTime(); // Dec 24 10:00 AM UTC
            const endTime = new Date(Date.UTC(currentYear, 11, 25, 11, 0, 0)).getTime();   // Dec 25 11:00 AM UTC
            
            // Check if we're outside the tracking window
            if (now < startTime || now > endTime) {
                return [84.6, 168]; // North Pole
            }
    
            // Find if Santa is at a stop
            const currentStop = destinations.find(stop => 
                now >= stop.arrival && now <= stop.departure
            );
    
            if (currentStop) {
                return [currentStop.location.lat, currentStop.location.lng];
            }
    
            // Find where Santa is between stops
            for (let i = 0; i < destinations.length - 1; i++) {
                const currentDest = destinations[i];
                const nextDest = destinations[i + 1];
    
                if (now > currentDest.departure && now < nextDest.arrival) {
                    const timeProgress = (now - currentDest.departure) / 
                                       (nextDest.arrival - currentDest.departure);
                    
                    const lat = currentDest.location.lat + 
                               (timeProgress * (nextDest.location.lat - currentDest.location.lat));
                    const lng = currentDest.location.lng + 
                               (timeProgress * (nextDest.location.lng - currentDest.location.lng));
                    
                    return [lat, lng];
                }
            }
    
            return [84.6, 168]; // Fallback to North Pole
        }
    
        // Function to update Santa's position
// Function to update Santa's position and visibility
function updateSantaPosition() {
    const now = Date.now();
    const currentYear = new Date().getUTCFullYear();
    const takeoffTime = new Date(Date.UTC(currentYear, 11, 24, 10, 0, 0)).getTime();
    const endTime = new Date(Date.UTC(currentYear, 11, 25, 11, 0, 0)).getTime();

    const newPosition = findSantaLocation();
    
    // Determine if Santa should be visible and which icon to use
    if (now < takeoffTime || now > endTime) {
        // Hide Santa before takeoff or after landing
        santaMarker.setOpacity(0);
    } else {
        // Show Santa during the journey
        santaMarker.setOpacity(1);
        
        // Check if Santa is at a stop
        const currentStop = destinations.find(stop => 
            now >= stop.arrival && now <= stop.departure
        );
        
        // Use chimney icon at stops, sleigh icon while traveling
        const icon = currentStop ? santaChimneyIcon : santaSleighIcon;
        santaMarker.setIcon(icon);
    }
    
// Update marker position
santaMarker.setLatLng(newPosition);

// --- üéÖ NEW: Update Santa's Path So Far! ---
const pathPoints = [[84.6, 168]]; // üè† Start at the North Pole

// Loop through all stops and add the ones he already visited
destinations.forEach(stop => {
    if (now >= stop.arrival) {
        pathPoints.push([stop.location.lat, stop.location.lng]);
    }
});

// Finish the path at Santa's current exact location
pathPoints.push(newPosition);

// Update the line on the map!
santaPath.setLatLngs(pathPoints);
    
    // Update map view if locked
    if (isLocked) {
// NEW WAY: Smooth Gliding! ‚ú®
        // We set duration to 1.0s to match your setInterval of 1000ms
        map.panTo(newPosition, {
            animate: false,
            // duration: 1.0, 
            easeLinearity: 1, // Constant speed (no acceleration/deceleration)
            noMoveStart: true // Prevents firing extra move events
        });
    }
}
    // Add these new functions
    function formatCountdown(milliseconds) {
    // Make sure we're dealing with positive numbers
    milliseconds = Math.max(0, milliseconds);
    
    const seconds = Math.floor(milliseconds / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);

    if (days >= 1) {
        return `${days}d`;
    }

    const padZero = num => num.toString().padStart(2, '0');

    if (hours > 0) {
        return `${padZero(hours)}:${padZero(minutes % 60)}:${padZero(seconds % 60)}`;
    } else {
        // Always show MM:SS format, even for small numbers
        return `${padZero(minutes)}:${padZero(seconds % 60)}`;
    }
}

function formatSantaETA(arrivalTime) {
    const now = Date.now();
    const timeUntil = arrivalTime - now;
    const hours = Math.floor(timeUntil / (1000 * 60 * 60));
    const minutes = Math.floor((timeUntil % (1000 * 60 * 60)) / (1000 * 60));
    
    // Santa has already visited - show distance traveled
    if (timeUntil < 0) {
        const distance = calculateTotalDistance();
        return `${distance.toLocaleString()} km`;
    }
    
    // Less than 30 minutes
    if (hours === 0 && minutes < 30) {
        return "üö® Quick, get to bed! Santa's arriving very soon! üõèÔ∏è";
    }
    
    // Less than an hour
    if (hours === 0) {
        if (minutes >= 45) {
            return "About 45 minutes until Santa arrives! üéÖ";
        } else if (minutes >= 30) {
            return "About 30 minutes until Santa arrives! ‚è∞";
        }
    }
    
    // Less than 24 hours
    if (hours < 24) {
        let hourText = 'hours';
        
        // Handle half-hour text
        if (minutes >= 30) {
            if (hours === 1) {
                hourText = 'hour'; // 1¬Ω hour
            }
            return `About ${hours}¬Ω ${hourText} until Santa arrives! üéÖ`;
        } else {
            if (hours === 1) {
                hourText = 'hour'; // 1 hour
            }
            return `About ${hours} ${hourText} until Santa arrives! üéÑ`;
        }
    }
    
    // More than 24 hours
    return "Santa is getting ready! üéÖ";
}

// Add this helper function to calculate total distance traveled
function calculateTotalDistance() {
    const now = Date.now();
    const currentYear = new Date().getUTCFullYear();
    const takeoffTime = new Date(Date.UTC(currentYear, 11, 24, 10, 0, 0)).getTime();
    
    // If before takeoff, return 0
    if (now < takeoffTime) {
        return 0;
    }
    
    let totalDistance = 0;
    let lastLocation = [84.6, 168]; // Start at North Pole
    
    for (let i = 0; i < destinations.length; i++) {
        const stop = destinations[i];
        
        // Calculate distance to this stop
        const distance = calculateDistance(
            lastLocation[0],
            lastLocation[1],
            stop.location.lat,
            stop.location.lng
        );
        
        // If we haven't reached this stop yet, break
        if (now < stop.arrival) {
            // Calculate partial distance to current position
            const currentPos = findSantaLocation();
            const partialDistance = calculateDistance(
                lastLocation[0],
                lastLocation[1],
                currentPos[0],
                currentPos[1]
            );
            totalDistance += partialDistance;
            break;
        }
        
        // Add distance to total
        totalDistance += distance;
        
        // Update last location
        lastLocation = [stop.location.lat, stop.location.lng];
        
        // If we're still at this stop, break
        if (now >= stop.arrival && now <= stop.departure) {
            break;
        }
    }
    
    return Math.round(totalDistance);
}


function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Earth's radius in km
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
        Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

let userLocation = null;
let closestStop = null;

function findClosestStop(userLat, userLng) {
    let minDistance = Infinity;
    let closest = null;

    destinations.forEach(stop => {
        const distance = calculateDistance(
            userLat, 
            userLng, 
            stop.location.lat, 
            stop.location.lng
        );
        
        if (distance < minDistance) {
            minDistance = distance;
            closest = stop;
        }
    });

    return closest;
}

// Track which mode we're in (true = presents, false = cookies)
let showPresents = true;

function calculatePresentsDelivered() {
    const now = Date.now();
    const currentYear = new Date().getUTCFullYear();
    const takeoffTime = new Date(Date.UTC(currentYear, 11, 24, 10, 0, 0)).getTime();
    const endTime = new Date(Date.UTC(currentYear, 11, 25, 11, 0, 0)).getTime();

    const presentsValue = document.querySelector('#presentsStatBox .stat-value');
    const formatNumber = num => num.toLocaleString('en-US');

    if (now < takeoffTime) {
        updatePresentsDisplay(0);
        return;
    }

    if (now > endTime) {
        updatePresentsDisplay(11550000000);
        return;
    }

    let totalPresents = 0;
    let currentStop = null;
    let nextStop = null;

    for (let i = 0; i < destinations.length; i++) {
        const stop = destinations[i];

        if (now >= stop.departure) {
            // Past this stop
            totalPresents = stop.presentsDelivered;

        } else if (now >= stop.arrival && now <= stop.departure) {
            // AT THIS STOP
            currentStop = stop;

            const stopDuration = stop.departure - stop.arrival;
            const timeAtStop = now - stop.arrival;
            const stopProgress = stopDuration > 0 ? timeAtStop / stopDuration : 1;

            const previousPresents = i > 0 ? destinations[i - 1].presentsDelivered : 0;
            const presentsToDeliver = stop.presentsDelivered - previousPresents;

            // STOP CALCULATION
            const stopCalculated =
                previousPresents + Math.floor(presentsToDeliver * stopProgress);

            // TRAVEL CALCULATION to avoid regression
            let travelCalculated = stopCalculated;
            if (i > 0) {
                const prevStop = destinations[i - 1];
                const travelDuration = stop.arrival - prevStop.departure;
                const timeInTravel = now - prevStop.departure;
                const travelProgress =
                    travelDuration > 0 ? timeInTravel / travelDuration : 1;

                travelCalculated =
                    previousPresents + Math.floor(presentsToDeliver * travelProgress);
            }

            // FINAL NUMBER: NEVER GO BACKWARDS
            totalPresents = Math.max(stopCalculated, travelCalculated);

            break;

        } else if (!nextStop && now < stop.arrival) {
            // TRAVELING TO NEXT STOP
            nextStop = stop;

            if (i > 0) {
                const prevStop = destinations[i - 1];
                const travelDuration = stop.arrival - prevStop.departure;
                const timeInTravel = now - prevStop.departure;
                const travelProgress = timeInTravel / travelDuration;

                const presentsDifference =
                    stop.presentsDelivered - prevStop.presentsDelivered;

                const presentsInTransit =
                    Math.floor(presentsDifference * travelProgress);

                totalPresents =
                    prevStop.presentsDelivered + presentsInTransit;
            }
            break;
        }
    }

    updatePresentsDisplay(totalPresents);
    window.realPresentsDelivered = totalPresents;
}


// üç™ NEW FUNCTION: Update the display based on mode
function updatePresentsDisplay(totalPresents) {
    const presentsValue = document.querySelector('#presentsStatBox .stat-value');
const presentsLabel = document.querySelector('#presentsStatBox .stat-label');
const presentsIcon = document.querySelector('#presentsStatBox .stat-icon');
    
    const formatNumber = num => num.toLocaleString('en-US');
    
    if (showPresents) {
        presentsValue.textContent = formatNumber(totalPresents);
        presentsLabel.textContent = 'Presents delivered';
        presentsIcon.textContent = 'featured_seasonal_and_gifts';
    } else {
        // Calculate cookies: presents √ó 0.375, rounded
        const totalCookies = Math.round(totalPresents * 0.375);
        presentsValue.textContent = formatNumber(totalCookies);
        presentsLabel.textContent = 'Cookies eaten';
        presentsIcon.textContent = 'cookie';
    }
}

// üç™ NEW FUNCTION: Handle click toggle with animation
function setupPresentsToggle() {
    const statBox = document.getElementById('presentsStatBox');
    
    statBox.addEventListener('click', () => {
        // Toggle the mode
        showPresents = !showPresents;
        
        // Add animation classes
        const icon = statBox.querySelector('.stat-icon');
        const value = statBox.querySelector('.stat-value');
        const label = statBox.querySelector('.stat-label');
        
        icon.classList.add('flip-animation');
        value.classList.add('flip-animation');
        label.classList.add('flip-animation');
        
        // Recalculate and update display
        const currentValue = parseInt(
    document.querySelector('#presentsStatBox .stat-value')
        .textContent.replace(/,/g, '')
);
        
        updatePresentsDisplay(showPresents ? currentValue : Math.round(currentValue / 0.375));
        
        // Remove animation classes after animation completes
        setTimeout(() => {
            icon.classList.remove('flip-animation');
            value.classList.remove('flip-animation');
            label.classList.remove('flip-animation');
        }, 600);
    });
}


function updateStats() {
    const now = Date.now();
    const currentYear = new Date().getUTCFullYear();
    const takeoffTime = new Date(Date.UTC(currentYear, 11, 24, 10, 0, 0)).getTime();
    const endTime = new Date(Date.UTC(currentYear, 11, 25, 11, 0, 0)).getTime();

    // Get references to stat elements
    const locationIcon = document.querySelector('.stat-box:nth-child(1) .stat-icon');
    const locationValue = document.querySelector('.stat-box:nth-child(1) .stat-value');
    const locationLabel = document.querySelector('.stat-box:nth-child(1) .stat-label');
    const timingIcon = document.querySelector('.stat-box:nth-child(1) .stat-timing-icon');
    const timingValue = document.querySelector('.stat-box:nth-child(1) .stat-timing-value');

    if (now < takeoffTime) {
        // Before takeoff
        locationIcon.textContent = 'location_on';
        locationValue. textContent = "Santa's Village, North Pole";
        locationLabel.textContent = 'Current Stop';
        
        timingIcon.textContent = 'flight_takeoff';
        timingValue.textContent = `${formatCountdown(takeoffTime - now)} until takeoff`;
    } else if (now > endTime) {
        // After journey completed
        locationIcon.textContent = 'location_on';
        locationValue. textContent = "Santa's Village, North Pole";
        locationLabel.textContent = 'Current Stop';
        
        const nextYearTakeoff = new Date(Date. UTC(currentYear + 1, 11, 24, 10, 0, 0)).getTime();
        timingIcon.textContent = 'flight_takeoff';
        timingValue.textContent = `${formatCountdown(nextYearTakeoff - now)} until next takeoff`;
    } else {
        // During journey
        const currentStop = destinations.find(stop => 
            now >= stop.arrival && now <= stop.departure
        );

        if (currentStop) {
            // At a stop
            locationIcon.textContent = 'location_on';
            locationValue.textContent = `${currentStop.city}, ${currentStop.region}`;
            locationLabel.textContent = 'Current Stop';
            
            timingIcon.textContent = 'flight_takeoff';
            timingValue.textContent = `${formatCountdown(currentStop.departure - now)} until departure`;
        } else {
            // Between stops
            const nextStop = destinations.find(stop => now < stop.arrival);
            if (nextStop) {
                locationIcon.textContent = 'directions';
                locationValue.textContent = `${nextStop.city}, ${nextStop.region}`;
                locationLabel.textContent = 'Next Stop';
                
                timingIcon.textContent = 'flight_land';
                timingValue.textContent = `${formatCountdown(nextStop.arrival - now)} until arrival`;
            }
        }
    }
}

function updateDistanceBox() {
    const now = Date.now();
    const currentYear = new Date().getUTCFullYear();
    const takeoffTime = new Date(Date.UTC(currentYear, 11, 24, 10, 0, 0)).getTime();
    const endTime = new Date(Date.UTC(currentYear, 11, 25, 11, 0, 0)).getTime();

    // Get references to 3rd stat box elements
    const distanceIcon = document.querySelector('.stat-box:nth-child(3) .stat-icon');
    const distanceValue = document.querySelector('.stat-box:nth-child(3) .stat-value');
    const distanceLabel = document.querySelector('.stat-box:nth-child(3) .stat-label');

    if (now < takeoffTime || now > endTime) {
        // Before takeoff or after journey - show distance
        distanceIcon.textContent = 'route';
        distanceLabel.textContent = 'Distance Travelled';
        distanceValue.textContent = `${calculateTotalDistance().toLocaleString()} km`;
    } else {
        // During journey - check if we have user location for ETA
        if (userLocation && closestStop && closestStop.arrival && now < closestStop.arrival) {
            // Show ETA if location enabled and Santa hasn't arrived yet
            distanceIcon.textContent = 'schedule';
            distanceLabel.textContent = "Santa's ETA";
            distanceValue. textContent = formatSantaETA(closestStop.arrival);
        } else {
            // Show distance travelled
            distanceIcon.textContent = 'route';
            distanceLabel.textContent = 'Distance Travelled';
            distanceValue.textContent = `${calculateTotalDistance().toLocaleString()} km`;
        }
    }
}

// Fun loading messages
const loadingMessages = [
    "Warming up the reindeer... ü¶å",
    "Checking Santa's naughty and nice list... üìú",
    "Polishing Rudolph's nose... ‚ú®",
    "Counting Christmas cookies... üç™",
    "Untangling Christmas lights... üí°",
    "Wrapping presents... üéÅ",
    "Training new elves... üßù‚Äç‚ôÇÔ∏è",
    "Feeding the reindeer... ü•ï",
    "Loading Christmas magic... ‚≠ê",
    "Syncing with Santa's sleigh GPS... üõ∑"
];

let messageIndex = 0;
const loadingMessagesElement = document.querySelector('.loading-messages');
const loadingScreen = document.querySelector('.loading-screen');

// Show loading messages one by one
const messageInterval = setInterval(() => {
    if (messageIndex < loadingMessages.length) {
        loadingMessagesElement.textContent = loadingMessages[messageIndex];
        messageIndex++;
    }
}, 1500);

        // Fetch destinations and start tracking
        fetch('https://api.npoint.io/6773861bf0f0db6d3189')
            .then(response => response.json())
            .then(data => {
                        // Clear the message interval
        clearInterval(messageInterval);
        
        // Hide loading screen
        loadingScreen.classList.add('fade-out');
        
        // Remove it from DOM after animation
        setTimeout(() => {
            loadingScreen.remove();
        }, 500);

    destinations = updateDestinationDates(data.destinations);

// üç™ Setup cookie toggle
setupPresentsToggle();

// üåç SMART GEOLOCATION LOGIC üåç

// Function to actually start tracking (called only if allowed)
function startUserTracking() {
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
            position => {
                userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                closestStop = findClosestStop(userLocation.lat, userLocation.lng);
                console.log("üìç User location set, closest stop:", closestStop);
            },
            error => {
                console.log("üö´ Location access denied by browser or error:", error);
            }
        );
    }
}

// Check if we should show the modal
const hasSeenLocationModal = localStorage.getItem('santaLocationSeen');
const locationModal = document.getElementById('locationModal');
const btnAllow = document.getElementById('allowLocation');
const btnDeny = document.getElementById('denyLocation');
const btnClose = document.getElementById('closeLocationModal');

// Helper to close modal
const closeModal = () => {
    locationModal.style.display = 'none';
};

if (!hasSeenLocationModal) {
    // First time? Show the popup!
    locationModal.style.display = 'flex';
} else if (localStorage.getItem('santaLocationAllowed') === 'true') {
    // Already said yes previously? Start tracking immediately!
    startUserTracking();
}

// Event Listeners for the modal

// 1. User clicks "Enable Access"
btnAllow.addEventListener('click', () => {
    localStorage.setItem('santaLocationSeen', 'true');
    localStorage.setItem('santaLocationAllowed', 'true'); // Remember they said YES
    closeModal();
    startUserTracking(); // Actually ask the browser now
});

// 2. User clicks "No thanks"
btnDeny.addEventListener('click', () => {
    localStorage.setItem('santaLocationSeen', 'true');
    localStorage.setItem('santaLocationAllowed', 'false'); // Remember they said NO
    closeModal();
    // Do nothing else, magic works without it!
});

// 3. User clicks "X"
btnClose.addEventListener('click', () => {
    localStorage.setItem('santaLocationSeen', 'true');
    localStorage.setItem('santaLocationAllowed', 'false'); // Treat X like a "No"
    closeModal();
});

    // Create a marker cluster group with custom options
const markers = L.markerClusterGroup({
    maxClusterRadius: 50,
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    zoomToBoundsOnClick: true,
    animate: true,
    disableClusteringAtZoom: 8, // Disable clustering at high zoom levels
    chunkedLoading: true,
    spiderLegPolylineOptions: { 
        weight: 1.5,
        color: 'var(--christmas-red)',
        opacity: 0.5
    }
});

// Icons for different states
const futureIcon = L.icon({
    iconUrl: 'assets/trees.png',
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -36],
    className: 'destination-marker'
});

const visitedIcon = L.icon({
    iconUrl: 'assets/sack.png',
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -36],
    className: 'destination-marker'
});

const satelliteIcon = L.icon({
    iconUrl: 'assets/satellite.png',
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -36],
    className: 'destination-marker'
});

// Function to fetch Wikipedia summary with better error handling + disambiguation retries
async function fetchWikiSummary(wikiLink, cityName = "", regionName = "") {
    const baseTerm = wikiLink.split("/wiki/")[1];

    async function tryFetch(term) {
        const response = await fetch(
            `https://en.wikipedia.org/api/rest_v1/page/summary/${term}`
        );

        if (!response.ok) return null;

        const data = await response.json();
        return data;
    }

    // 1 ‚Äî Try the original
    let data = await tryFetch(baseTerm);

    // Detect disambiguation: summary starts with "_ may refer to"
    const isDisambiguation = d =>
        d?.extract?.trim().toLowerCase().includes("may refer to");

    if (data && !isDisambiguation(data)) {
        return {
            extract: data.extract || "No summary available.",
            fullLink: wikiLink
        };
    }

    // 2 ‚Äî Try CITY,_REGION
    if (cityName && regionName) {
        const regionAttempt = `${cityName.replace(/ /g, "_")},_${regionName.replace(/ /g, "_")}`;
        const regionData = await tryFetch(regionAttempt);

        if (regionData && !isDisambiguation(regionData)) {
            return {
                extract: regionData.extract || "No summary available.",
                fullLink: `https://en.wikipedia.org/wiki/${regionAttempt}`
            };
        }
    }

    // 3 ‚Äî Try CITY_(city)
    if (cityName) {
        const cityAttempt = `${cityName.replace(/ /g, "_")}_(city)`;
        const cityData = await tryFetch(cityAttempt);

        if (cityData && !isDisambiguation(cityData)) {
            return {
                extract: cityData.extract || "No summary available.",
                fullLink: `https://en.wikipedia.org/wiki/${cityAttempt}`
            };
        }
    }

    // 4 ‚Äî Fully give up  
    return {
        extract: "Couldn't get info for this city.",
        fullLink: wikiLink
    };
}



// Known ambiguous cities ‚Üí best Wikipedia title
const WIKI_DISAMBIGUATION_MAP = {
    "Springfield": "Springfield,_Illinois",
    "Portland": "Portland,_Oregon",
    "Columbus": "Columbus,_Ohio",
    "San Jose": "San_Jose,_California",
    "Melbourne": "Melbourne",
    "Paris": "Paris",
    "Cairo": "Cairo",
    "Athens": "Athens",
    "Alexandria": "Alexandria,_Egypt",
    "Victoria": "Victoria,_British_Columbia",
    "Sydney": "Sydney",
};


function createPopupContent(dest, index) {
    const now = Date.now();
    const isVisited = now > dest.departure;

    const previousPresents = index > 0 ? destinations[index - 1].presentsDelivered : 0;
    const presentsAtStop = dest.presentsDelivered - previousPresents;

    const formatNiceDate = (timestamp, tzOffset = 0) => {
        const date = new Date(timestamp + tzOffset);
        return date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
        });
    };

    const localArrival = formatNiceDate(dest.arrival);
    const destArrival = formatNiceDate(dest.arrival, dest.details.timezone * 1000);

    let arrivalTimeDisplay = '';
    if (isVisited) {
        arrivalTimeDisplay = `
            <div class="time-info">
                <span class="material-symbols-rounded info-icon">schedule</span>
                <div class="info-text">
                    <div class="info-label">Arrival</div>
                    <div class="info-value">
                        Your time: ${localArrival}<br>
                        ${dest.city} time: ${destArrival}
                    </div>
                </div>
            </div>`;
    } else {
        const arrivalDate = new Date(dest.arrival);
        const hourStart = new Date(arrivalDate); hourStart.setMinutes(0,0,0);
        const hourEnd = new Date(hourStart); hourEnd.setHours(hourEnd.getHours()+1);

        const formatTime = d => d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});
        
        const userStart = formatTime(hourStart);
        const userEnd = formatTime(hourEnd);
        const userDate = hourStart.toLocaleDateString('en-US',{month:'short',day:'numeric'});

        const destHourStart = new Date(hourStart.getTime() + (dest.details.timezone * 1000));
        const destHourEnd = new Date(hourEnd.getTime() + (dest.details.timezone * 1000));

        const destStart = formatTime(destHourStart);
        const destEnd = formatTime(destHourEnd);
        const destDate = destHourStart.toLocaleDateString('en-US',{month:'short',day:'numeric'});

        arrivalTimeDisplay = `
            <div class="time-info">
                <span class="material-symbols-rounded info-icon">schedule</span>
                <div class="info-text">
                    <div class="info-label">Estimated arrival window</div>
                    <div class="info-value">
                        Your time: ${userDate}, ${userStart} ‚Äì ${userEnd}<br>
                        ${dest.city} time: ${destDate}, ${destStart} ‚Äì ${destEnd}
                    </div>
                </div>
            </div>`;
    }

    // Photos
    let photoSection = '';
    if (dest.details.photos?.length > 0) {
        const randomPhoto = dest.details.photos[Math.floor(Math.random() * dest.details.photos.length)];
        photoSection = `
            <div class="photo-carousel">
                <img src="${randomPhoto.url}" class="carousel-image active" alt="${dest.city} photo">
                <div class="carousel-attribution">${randomPhoto.attributionHtml}</div>
            </div>`;
    }

    const wikiPlaceholder = `
        <div id="wiki-${index}" class="wiki-section loading-wiki">
            <div class="wiki-loading">Loading info‚Ä¶</div>
        </div>
    `;

    return `
        <div class="custom-popup">
            ${photoSection}
            <div class="popup-content">

                <div class="location-info">
                    <span class="material-symbols-rounded info-icon">location_on</span>
                    <div>
                        <div class="city-title">${dest.city}</div>
                        <div class="region-text">${dest.region}</div>
                    </div>
                </div>

                ${arrivalTimeDisplay}

                <div class="presents-info">
                    <span class="material-symbols-rounded info-icon">featured_seasonal_and_gifts</span>
                    <div class="info-text">
                        <div class="info-label">Presents ${isVisited ? 'delivered' : 'to deliver'}</div>
                        <div class="info-value">${presentsAtStop.toLocaleString()}</div>
                    </div>
                </div>

                ${wikiPlaceholder}

            </div>
        </div>`;
}


// Initial marker creation (only once)
destinations
    .filter(dest => !(dest.city === "Santa's Village" && dest.region === "North Pole"))
    .forEach((dest, index) => {
        const marker = L.marker([dest.location.lat, dest.location.lng], {
            icon: futureIcon,
            zIndexOffset: 1000,
        })
        .bindTooltip(dest.city, {
            permanent: false,
            direction: 'top',
            offset: [0, -40],
            className: 'custom-tooltip'
        })
        .bindPopup(() => createPopupContent(dest, index), {
            autoPan: false,
            closeButton: true
        });

        marker.on("popupopen", async () => {
    const wikiBox = document.getElementById(`wiki-${index}`);
    if (!wikiBox) return;

    // Determine Wikipedia link
    let wikiTitle;
    if (dest.region === "North Pole") wikiTitle = "North_Pole";
    else if (dest.region === "Low Earth Orbit") wikiTitle = "Satellite";
    else {
        let lookup = dest.city.trim();
        if (WIKI_DISAMBIGUATION_MAP[lookup]) {
            wikiTitle = WIKI_DISAMBIGUATION_MAP[lookup];
        } else {
            wikiTitle = lookup.replace(/\s+/g, "_");
        }
    }

    const wikiLink = `https://en.wikipedia.org/wiki/${wikiTitle}`;

    try {
        const data = await fetchWikiSummary(wikiLink);

        wikiBox.innerHTML = `
            <div class="wiki-header">
                <span class="material-symbols-rounded wiki-icon">info</span>
                About ${dest.city}
            </div>
            <div class="wiki-extract">${data.extract}</div>
            <a class="wiki-readmore" href="${data.fullLink}" target="_blank">
                Read more on Wikipedia ‚Üí
            </a>
        `;
    } catch (err) {
        wikiBox.innerHTML = `
            <div class="wiki-error">‚ö†Ô∏è Could not load Wikipedia info.</div>
        `;
    }
});


        markers.addLayer(marker);
    });

// Add marker cluster to map
map.addLayer(markers);


// Function to update markers
function updateMarkers() {
    const now = Date.now();

    markers.eachLayer((marker) => {
        // Match marker to destination
        const dest = destinations.find(d =>
            d.location.lat === marker.getLatLng().lat &&
            d.location.lng === marker.getLatLng().lng
        );

        if (!dest) return;

        const isVisited = now > dest.departure;
        const isCurrent = now >= dest.arrival && now <= dest.departure;

        // üõ∞Ô∏è Decide correct icon
        let newIcon;

        if (dest.region === "Low Earth Orbit") {
            newIcon = satelliteIcon;
        } else {
            newIcon = isVisited ? visitedIcon : futureIcon;
        }

        // Update icon only if it actually changed
        const currentIcon = marker.getIcon();
        if (currentIcon.options.iconUrl !== newIcon.options.iconUrl) {
            marker.setIcon(newIcon);
        }

        // Z-index: future + orbit stops stay on top
        marker.setZIndexOffset(isVisited ? 0 : 1000);

        // Hide marker if Santa is currently there
        marker.setOpacity(isCurrent ? 0 : 1);
    });
}


// Initial update
updateMarkers();

function hardResync() {
    // Recalculate everything from absolute time
    calculatePresentsDelivered();
    updateStats();
    updateDistanceBox();
    updateMarkers();
    updateSantaPosition();
}


// Start updating Santa's position AND stats every second
setInterval(() => {
    if (trackerPaused) return;
    updateSantaPosition();
    updateStats();
    updateDistanceBox();
    calculatePresentsDelivered();
    updateMarkers();

        // üéÑ Update sidebar title based on takeoff time
        const titleElement = document.querySelector('.sidebar-updates-title');
    if (titleElement) {
        const now = Date.now();
        const currentYear = new Date().getUTCFullYear();
        const trackingStart = new Date(Date.UTC(currentYear, 11, 24, 10, 0, 0)).getTime(); // Dec 24 10:00 UTC

        if (now < trackingStart) {
            titleElement.textContent = "From the North Pole";
        } else {
            titleElement.textContent = "From the sleigh";
        }
    }
}, 1000);
})

            .catch(error => console.error('Error fetching destinations:', error));
    
        // Fullscreen control
        const fullscreenBtn = document.querySelector('.control-button:nth-child(2)');
        const fullscreenIcon = fullscreenBtn.querySelector('.material-symbols-rounded');
    
        fullscreenBtn.addEventListener('click', () => {
            if (!isFullscreen) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
                fullscreenIcon.textContent = 'fullscreen_exit';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
                fullscreenIcon.textContent = 'fullscreen';
            }
            isFullscreen = !isFullscreen;
        });
    
        // Handle fullscreen change from other sources
        document.addEventListener('fullscreenchange', () => {
            isFullscreen = !!document.fullscreenElement;
            fullscreenIcon.textContent = isFullscreen ? 'fullscreen_exit' : 'fullscreen';
        });
    
        // Lock/Unlock control
        const lockBtn = document.querySelector('.control-button:nth-child(3)');
        const lockIcon = lockBtn.querySelector('.material-symbols-rounded');
    
        lockBtn.addEventListener('click', () => {
    isLocked = !isLocked;
    lockIcon.textContent = isLocked ? 'lock' : 'lock_open';
    
    // Update map controls
    map.dragging[isLocked ? 'disable' : 'enable']();
    map.keyboard[isLocked ? 'disable' : 'enable']();
    map.touchZoom[isLocked ? 'disable' : 'enable']();
    map.scrollWheelZoom[isLocked ? 'disable' : 'enable']();
    
    // Keep zoom control enabled
    if (!map.zoomControl) {
        map.addControl(L.control.zoom());
    }
    
    if (isLocked) {
        map.setView(santaMarker.getLatLng(), map.getZoom(), {
            animate: true
        });
    }
});

// Background music handling
document.addEventListener('DOMContentLoaded', function() {
    const bgMusic = document.getElementById('bgMusic');
    
    // Try to play automatically
    bgMusic.play().catch(function(error) {
        console.log("Autoplay prevented, waiting for user interaction");
    });

    // Add click listener to document to start music on first interaction
    document.addEventListener('click', function startMusic() {
        bgMusic.play().then(function() {
            // Remove the click listener once music starts
            document.removeEventListener('click', startMusic);
        }).catch(function(error) {
            console.log("Playback failed:", error);
        });
    }, { once: true });

    // Keep trying to play music when tab becomes visible
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            bgMusic.play().catch(function(error) {
                console.log("Playback failed on visibility change");
            });
        }
    });
});

// Function to update timestamps to current year
function updateUpdateTimestamps(updates) {
    const currentYear = new Date().getUTCFullYear();
    return updates.map(update => {
        const originalDate = new Date(update.timestamp);
        const newDate = new Date(Date.UTC(
            currentYear,
            originalDate.getUTCMonth(),
            originalDate.getUTCDate(),
            originalDate.getUTCHours(),
            originalDate.getUTCMinutes(),
            originalDate.getUTCSeconds()
        ));
        return {
            ...update,
            timestamp: newDate.getTime()
        };
    });
}

// Photo modal
const imageModal = document.getElementById('imageModal');
const modalImage = document.getElementById('modalImage');
const closeImageModal = document.getElementById('closeImageModal');

function openImageModal(url) {
    modalImage.src = url;
    imageModal.style.display = 'flex';
}

closeImageModal.addEventListener('click', () => {
    imageModal.style.display = 'none';
});


// Function to check if we're in the tracking window
function isInTrackingWindow() {
    const now = Date.now();
    const currentYear = new Date().getUTCFullYear();
    const startTime = new Date(Date.UTC(currentYear, 11, 24, 8, 30, 0)).getTime(); // Dec 24 8:30 AM UTC
    const endTime = new Date(Date.UTC(currentYear, 11, 25, 11, 0, 0)).getTime();   // Dec 25 11:00 AM UTC
    return now >= startTime && now <= endTime;
}

// Function to find current update and next update
function findUpdates(updates) {
    const now = Date.now();
    
    // Filter valid updates (NOW including imageUrl!)
    const validUpdates = updates
        .filter(update => update.status || update.didyouknow || update.imageUrl)
        .sort((a, b) => a.timestamp - b.timestamp);
    
    // Most recent update in the past
    const currentUpdate = validUpdates
        .filter(update => update.timestamp <= now)
        .pop();
    
    // Next update in the future
    const nextUpdate = validUpdates
        .find(update => update.timestamp > now);
    
    return { currentUpdate, nextUpdate };
}

// Function to update the status bar
function updateStatusBar(updates) {
    const updateBar = document.querySelector('.santa-update-bar');
    const updateMessage = document.querySelector('.update-message');
    const nextUpdateP = document.querySelector('.next-update');
    const updateCountdown = document.querySelector('.update-countdown');
    const updateIcon = document.querySelector('.update-icon');
    
    // Check if we should show updates
    if (!isInTrackingWindow()) {
        updateBar.style.display = 'none';
        return;
    }
    
    const { currentUpdate, nextUpdate } = findUpdates(updates);
    
    if (currentUpdate) {
        updateBar.style.display = 'block';
        
        if (currentUpdate.didyouknow) {
            // Switch icon to question mark
            updateIcon.textContent = 'help';
            // Add bold Did you know?
            updateMessage.innerHTML = `<span class="didyouknow">Did you know?</span> ${currentUpdate.didyouknow}`;
        } else {
            if (currentUpdate.imageUrl) {
    updateIcon.textContent = 'photo_camera';

    // clickable hyperlink that opens modal
    updateMessage.innerHTML = `
        <a class="image-link" href="#" 
           style="
               font-weight: 700;
               color: var(--christmas-gold, #d4a017);
               text-decoration: underline;
               text-underline-offset: 3px;
           ">
            Santa shared a photo üì∏ (tap to view)
        </a>
    `;

    const link = updateMessage.querySelector('.image-link');
    link.addEventListener('click', (e) => {
        e.preventDefault();
        openImageModal(currentUpdate.imageUrl);
    });

} else {
    // normal text update
    updateIcon.textContent = 'chat';
    updateMessage.textContent = currentUpdate.status;
}

        }
        
        if (nextUpdate) {
            nextUpdateP.style.display = 'block';
            const timeToNext = nextUpdate.timestamp - Date.now();
            updateCountdown.textContent = formatCountdown(timeToNext);
        } else {
            nextUpdateP.style.display = 'none';
        }
    } else {
        updateBar.style.display = 'none';
    }
}

function updateSidebarUpdates(updates) {
    const currentMsg = document.getElementById('sidebarCurrentUpdateText');
    const nextText = document.querySelector('.sidebar-update-card-time');
    const nextCountdown = document.querySelector('.sidebar-update-countdown');
    const historyEl = document.getElementById('sidebarUpdateHistory');
    const iconEl = document.querySelector('.sidebar-update-card-icon');
    const titleEl = document.querySelector('.sidebar-update-card-title');
    const currentTimestamp = document.getElementById("sidebarCurrentTimestamp");
    const trackingStarts = Date.UTC(2024, 11, 24, 10, 0, 0); 

    const { currentUpdate, nextUpdate } = findUpdates(updates);

    const updatesSection = document.querySelector('.sidebar-updates');

    // If no valid updates exist ‚Üí hide entire section
    const hasRealContent = currentUpdate && (currentUpdate.status || currentUpdate.didyouknow || currentUpdate.imageUrl);

    if (!hasRealContent) {
        updatesSection.style.display = 'none';
        return;
    } else {
        updatesSection.style.display = '';
    }

// CURRENT UPDATE
if (currentUpdate.didyouknow) {
    titleEl.textContent = "Did you know?";
    iconEl.textContent = 'help';
    currentMsg.innerHTML = currentUpdate.didyouknow;
} else {
    // Detect image-only Santa update
    const isImageOnly = currentUpdate.imageUrl && !currentUpdate.status;

    const isBeforeTracking = currentUpdate.timestamp < trackingStarts;

titleEl.textContent = isImageOnly
    ? "Santa snapshot"
    : isBeforeTracking
        ? "North Pole update"
        : "Santa update";

        iconEl.textContent = isImageOnly ? "photo_camera" : "chat";

    if (currentUpdate.imageUrl) {
        currentMsg.innerHTML = `
            <img src="${currentUpdate.imageUrl}" 
                 style="width:100%;height:auto;display:block;border-radius:12px;margin-top:6px;" />
        `;
    } else {
        currentMsg.textContent = currentUpdate.status;
    }
}


    // Timestamp for current update
    currentTimestamp.textContent = new Date(currentUpdate.timestamp)
        .toLocaleTimeString([], { hour: "numeric", minute: "2-digit" });

    // Next update countdown
    if (nextUpdate) {
        nextText.style.display = 'block';
        nextCountdown.textContent = formatCountdown(nextUpdate.timestamp - Date.now());
    } else {
        nextText.style.display = 'none';
    }

    // HISTORY (older updates)
    const currentUpdateCard = document.getElementById("currentUpdateCard");

    // remove ONLY old updates
    Array.from(historyEl.children).forEach(c => {
        if (c !== currentUpdateCard) c.remove();
    });

    updates
        .filter(u =>
            u.timestamp < currentUpdate.timestamp &&
            (u.status || u.didyouknow || u.imageUrl)
        )
        .sort((a, b) => b.timestamp - a.timestamp)
        .slice(0, 20)
        .forEach(update => {
            const card = document.createElement('div');
            card.className = 'sidebar-update-card';

            const time = new Date(update.timestamp).toLocaleTimeString([], {
                hour: 'numeric',
                minute: '2-digit'
            });

            const content = update.didyouknow
                ? update.didyouknow
                : update.imageUrl
                ? `<img src="${update.imageUrl}" class="sidebar-update-image" style="width:100%;border-radius:12px;margin-top:6px;" />`
                : update.status;

            card.innerHTML = `
                <div class="sidebar-update-card-header">
                    <span class="material-symbols-rounded sidebar-update-card-icon">
${
    update.didyouknow
        ? "help"
        : update.imageUrl && !update.status
            ? "photo_camera"
            : "chat"
}
                    </span>
                    <span class="sidebar-update-card-title">
${
    update.didyouknow
        ? "Did you know?"
        : update.imageUrl && !update.status
            ? "Santa snapshot"
            : "Update from Santa"
}
                    </span>
                </div>

                <div class="sidebar-update-card-time">${time}</div>

                <div class="sidebar-update-card-text">
                    ${content}
                </div>

                <div class="sidebar-update-card-engagement">
                    <span class="material-symbols-rounded">favorite</span>
                    <span class="material-symbols-rounded">chat_bubble</span>
                    <span class="material-symbols-rounded">repeat</span>
                    <span class="material-symbols-rounded">send</span>
                </div>
            `;

            historyEl.appendChild(card);
        });
}
// --- Place this in your existing <script> block! ---

// Check for Fullscreen API support and hide the button if not supported
function checkFullscreenSupport() {
    const fsButton = document.getElementById('fullscreenButton');
    if (!fsButton) return; // Safety check in case the ID is missing

    // Check for standard or vendor-prefixed fullscreen methods on the document body
    // The main properties are 'fullscreenEnabled' and 'requestFullscreen' on an element
    const isSupported = (
        document.fullscreenEnabled || // Standard
        document.webkitFullscreenEnabled || // Chrome/Safari/Edge (old)
        document.mozFullScreenEnabled || // Firefox
        document.msFullscreenEnabled // IE/Edge (older)
    );

    if (!isSupported) {
        console.log("ü•∫ Fullscreen API not supported, hiding button.");
        // Hide the button by setting its CSS display property to 'none'
        fsButton.style.display = 'none'; 
    } else {
        console.log("ü§© Fullscreen API supported! Button is visible.");
        // You should probably add the event listener for the button here too!
        // fsButton.addEventListener('click', toggleFullscreen); // You'll need to define toggleFullscreen
    }
}

// Call the function once the page is loaded!
// Best place is right after your map setup, like at the very end of your script.
checkFullscreenSupport();

// --- End of the new code block ---


// Fetch and initialize updates
let santaUpdates = [];
fetch('https://api.npoint.io/c3db6f018ac08b9c8e2d')
    .then(response => response.json())
    .then(data => {
        santaUpdates = updateUpdateTimestamps(data.tracking_updates);
        // Initial update
        updateStatusBar(santaUpdates);
        updateSidebarUpdates(santaUpdates);
        // Add to the existing setInterval that updates other stats
        setInterval(() => {
            if (trackerPaused) return;
            updateStatusBar(santaUpdates);
            updateSidebarUpdates(santaUpdates);
        }, 1000);
    })
    .catch(error => console.error('Error fetching Santa updates:', error));

    function updateSidebar() {
    const sidebar = document.getElementById('sidebar');
    if (!sidebar) return; // desktop only

    // --- MOBILE SOURCE ELEMENTS ---
    const mobileLocationValue = document.querySelector('.stat-box:nth-child(1) .stat-value');
    const mobileLocationLabel = document.querySelector('.stat-box:nth-child(1) .stat-label');
    const mobileTimingValue   = document.querySelector('.stat-box:nth-child(1) .stat-timing-value');
    const mobileTimingIcon    = document.querySelector('.stat-box:nth-child(1) .stat-timing-icon');

    const mobileDistanceValue = document.querySelector('.stat-box:nth-child(3) .stat-value');
    const mobileDistanceLabel = document.querySelector('.stat-box:nth-child(3) .stat-label');
    const mobileDistanceIcon  = document.querySelector('.stat-box:nth-child(3) .stat-icon');

    // ALWAYS use real values for presents/cookies
    const sidebarCookiesValue = document.getElementById('sidebarCookiesValue');

    // --- LOCATION ---
    const sidebarLocation = document.getElementById('sidebarLocation');
    if (sidebarLocation && mobileLocationValue) {
        sidebarLocation.textContent = mobileLocationValue.textContent;
    }

    const sidebarLocationLabel = document.getElementById('sidebarLocationLabel');
    if (sidebarLocationLabel && mobileLocationLabel) {
        sidebarLocationLabel.textContent = mobileLocationLabel.textContent;
    }

    // --- TIMING ---
    const sidebarTiming = document.getElementById('sidebarTiming');
    if (sidebarTiming && mobileTimingValue) {
        sidebarTiming.textContent = mobileTimingValue.textContent;
    }

    // --- PRESENTS / COOKIES ---
    const sidebarPresentsValue = document.getElementById('sidebarPresentsValue');
    if (sidebarPresentsValue) {
        sidebarPresentsValue.textContent =
            window.realPresentsDelivered.toLocaleString('en-US');
    }

    if (sidebarCookiesValue) {
        const cookies = Math.round(window.realPresentsDelivered * 0.375);
        sidebarCookiesValue.textContent = cookies.toLocaleString('en-US');
    }

    // --- DISTANCE ---
    const sidebarDistanceValue = document.getElementById('sidebarDistanceValue');
    const sidebarDistanceLabel = document.getElementById('sidebarDistanceLabel');

    if (sidebarDistanceValue && mobileDistanceValue) {
        sidebarDistanceValue.textContent = mobileDistanceValue.textContent;
    }

    if (sidebarDistanceLabel && mobileDistanceLabel) {
        sidebarDistanceLabel.textContent = mobileDistanceLabel.textContent;
    }

    // --- ICON MIRRORING (now shifted due to LIVE banner) ---
    // NEW ORDER:
    // nth-child(1) = live banner
    // nth-child(2) = location
    // nth-child(3) = presents
    // nth-child(4) = cookies
    // nth-child(5) = distance

    // LOCATION ICON (now sidebar-stat #2)
    const mobileLocationIcon = document.querySelector('.stat-box:nth-child(1) .stat-icon');
    const sidebarLocationIcon = document.querySelector('.sidebar-stat:nth-child(2) .sidebar-stat-icon span');
    if (sidebarLocationIcon && mobileLocationIcon) {
        sidebarLocationIcon.textContent = mobileLocationIcon.textContent;
    }

    // TIMING ICON (inside sidebar-stat #2)
    const sidebarTimingIcon = document.querySelector('.sidebar-stat:nth-child(2) .sidebar-stat-timing-icon');
    if (sidebarTimingIcon && mobileTimingIcon) {
        sidebarTimingIcon.textContent = mobileTimingIcon.textContent;
    }

    // DISTANCE ICON (now sidebar-stat #5)
    const sidebarDistanceIcon = document.querySelector('.sidebar-stat:nth-child(5) .sidebar-stat-icon span');
    if (sidebarDistanceIcon && mobileDistanceIcon) {
        sidebarDistanceIcon.textContent = mobileDistanceIcon.textContent;
    }
}




// Update sidebar every second (desktop only)
setInterval(() => {
    if (trackerPaused) return;
    updateSidebar();
}, 1000);

// Setup sidebar presents toggle
const sidebarPresentsBox = document.getElementById('sidebarPresents');
if (sidebarPresentsBox) {
    sidebarPresentsBox.addEventListener('click', () => {
        showPresents = !showPresents;
        const icon = sidebarPresentsBox. querySelector('.sidebar-stat-icon span');
        const value = document.getElementById('sidebarPresentsValue');
        const label = document.getElementById('sidebarPresentsLabel');
        
        icon.classList.add('flip-animation');
        value.classList.add('flip-animation');
        label.classList.add('flip-animation');

        const currentValue = parseInt(document.getElementById('sidebarPresentsValue').textContent.replace(/,/g, ''));
        updateSidebarPresents(showPresents ?  currentValue :  Math.round(currentValue / 0.375));

        setTimeout(() => {
            icon.classList.remove('flip-animation');
            value.classList.remove('flip-animation');
            label.classList.remove('flip-animation');
        }, 600);
    });
}

function updateSidebarPresents(totalPresents) {
    const value = document.getElementById('sidebarPresentsValue');
    const label = document.getElementById('sidebarPresentsLabel');
    const icon = document.getElementById('sidebarPresentsIcon');
    const formatNumber = num => num.toLocaleString('en-US');

    if (showPresents) {
        value.textContent = formatNumber(totalPresents);
        label.textContent = 'Presents Delivered';
        icon.textContent = 'featured_seasonal_and_gifts';
    } else {
        const totalCookies = Math.round(totalPresents * 0.375);
        value.textContent = formatNumber(totalCookies);
        label.textContent = 'Cookies Eaten';
        icon.textContent = 'cookie';
    }
}

/* --- NEW ACTIVITY CARD LOGIC --- */

// 1. The full list of awesome activities!
const ACTIVITIES = [
    // Games & Fun Street
    { name: "Reindeer vs Elves", description: "Choose a side and battle it out in a festive tug-of-war! üÜö", href: "games/reindeer-vs-elves.html", icon: "sports_mma" },
    { name: "Santa's Gift Catch", description: "Catch the falling gifts while dodging those sneaky snowflakes! üéÅ", href: "games/gift-catch.html", icon: "featured_seasonal_and_gifts" },
    { name: "Santa's Memory Match", description: "Match the festive pairs in this jolly memory game! üÉè", href: "games/memory-match.html", icon: "extension" },
    { name: "Christmas Quiz", description: "Test your holiday knowledge with festive trivia! üéÑ", href: "games/quiz.html", icon: "help" },
    
    // Knowledge Lane (North Pole Secrets! ü§´)
    { name: "Santa's Sleigh", description: "Discover the magic behind Santa's ride! üõ∑", href: "knowledge/sleigh.html", icon: "rocket" },
    { name: "Santa's Route", description: "Learn how Santa plans his journey! üó∫Ô∏è", href: "knowledge/route.html", icon: "route" },
    { name: "Santa Tracking", description: "Learn how we track Santa's magical journey around the world! üõ∞Ô∏è", href: "knowledge/tracking.html", icon: "satellite_alt" },
    { name: "Santa's Workshop", description: "Take a peek inside the magical factory! üõ†Ô∏è", href: "knowledge/workshop.html", icon: "engineering" },
    { name: "A Day in the Life of an Elf", description: "Experience 24 hours as a North Pole elf! üßù", href: "knowledge/elf-life.html", icon: "work" },
    { name: "Santa's Helpers", description: "Meet the team behind the magic! üßë‚ÄçüéÑ", href: "knowledge/helpers.html", icon: "groups" },
    { name: "Santa's Off-Season", description: "What does Santa do in summer? üèñÔ∏è", href: "knowledge/off-season.html", icon: "beach_access" },
    { name: "The Gift Journey", description: "Follow a present's magical adventure! üéÅ", href: "knowledge/gift-journey.html", icon: "featured_seasonal_and_gifts" },
    
    // Festive Square (More Fun Stuff! üéâ)
    { name: "GST 2017", description: "A festive revival of the classic 2017 Google Santa Tracker! üéÖ", href: "https://speechless-parrot.github.io/gst-2017", icon: "celebration" },
    { name: "Chat with Tinsel", description: "Have a magical conversation with Santa's helper elf! üßù‚Äç‚ôÇÔ∏è", href: "interactive/elf-chat.html", icon: "chat" },
    { name: "Christmas Jokes", description: "Get your daily dose of holiday humor! üòÇ", href: "interactive/jokes.html", icon: "sentiment_very_satisfied" },
    { name: "Holiday Traditions", description: "Explore Christmas around the world! üåç", href: "interactive/traditions.html", icon: "globe" },
];


let lastActivityIndex = -1; // To avoid showing the same activity twice in a row

function renderRandomActivity() {
    const container = document.getElementById('randomActivityCardContainer');
    if (!container) return; // Safety check

    let randomIndex;
    do {
        // Pick a new random index
        randomIndex = Math.floor(Math.random() * ACTIVITIES.length);
    } while (randomIndex === lastActivityIndex); // Keep picking until it's a different one

    const activity = ACTIVITIES[randomIndex];
    lastActivityIndex = randomIndex; // Save the current index

    // Generate the full HTML for the card (using 'a' tag for clicking)
    const cardHtml = `
        <a class="activity-card" href="${activity.href}" rel="noopener noreferrer">
            <div class="activity-card-content">
                <span class="material-symbols-rounded">${activity.icon}</span>
                <h3>${activity.name}</h3>
                <p>${activity.description}</p>
            </div>
        </a>
    `;

    // Inject the card into the container (using innerHTML to replace the previous one)
    container.innerHTML = cardHtml;
}


// 2. Initial call + Auto-rotation (every 8 seconds, totally adjustable!)
renderRandomActivity();
setInterval(renderRandomActivity, 8000); // 8000ms = 8 seconds rotation

window.addEventListener('offline', () => {
    trackerPaused = true;
    console.log("üì° Connection lost ‚Äî tracker paused");

    // Optional: show message
    // showSantaUpdate("Signal lost to the North Pole‚Ä¶ üì°‚ùÑÔ∏è");
});

window.addEventListener('online', () => {
    trackerPaused = false;
    console.log("‚úÖ Connection restored ‚Äî hard resync");

    hardResync();
});


    </script>
</body>
</html>
